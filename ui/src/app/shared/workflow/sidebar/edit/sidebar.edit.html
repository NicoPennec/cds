<div class="sidebar-node-edit" *ngIf="node">
    <!-- Display Name + Pipeline-->

    <h3 class="ui header ml5">
        <i class="settings icon"></i>
        <!-- PIPELINE AND FORK -->
        <ng-container *ngIf="node.type === 'pipeline' || node.type === 'fork'">
            <div class="content">
                <ng-container *ngIf="!displayInputName">
                    <span>{{node.name}}</span>
                    <a class="inline pointing ml5" (click)="openRenameArea()"
                       *ngIf="workflow.permission === permissionEnum.READ_WRITE_EXECUTE">
                        <i class="pencil icon float"></i>
                    </a>
                </ng-container>
                <ng-container *ngIf="displayInputName">
                    <div class="ui fluid mini action input">
                        <input type="text" [(ngModel)]="node.name">
                        <div class="ui icon buttons">
                            <button class="ui green button" (click)="rename()"><i class="check icon"></i></button>
                            <button class="ui blue button"><i class="close icon"
                                                              (click)="displayInputName = false; node.name = previousNodeName"></i>
                            </button>
                        </div>
                    </div>
                </ng-container>
                <div class="sub header" *ngIf="node.type === 'pipeline'">
                    <span>{{ 'common_pipeline' | translate }} : {{workflow.pipelines[node.context.pipeline_id].name}}</span>
                    <div class="inline pointing ml5" (click)="openWarningModal()" *ngIf="displayInputName && nameWarning &&
                  nameWarning.nodes?.length > 0">
                        <i class="orange warning sign icon  animated infinite tada"></i>
                    </div>
                </div>
            </div>
        </ng-container>
        <!-- JOIN -->
        <ng-container *ngIf="node.type === 'join' || node.type === 'outgoinghook'">
            <div class="content">
                <span>{{ node.type | titlecase}}</span>
                <div class="sub header">
                    <span>{{ 'workflow_node_edition' | translate }}</span>
                </div>
            </div>
        </ng-container>
    </h3>

    <div class="ui fluid vertical menu noborder">
        <!-- Context -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="openEditContextModal()">
                <span *ngIf="workflow.permission === permissionEnum.READ_WRITE_EXECUTE">{{ 'workflow_node_context_edit' | translate }}</span><span
                    *ngIf="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">{{ 'workflow_node_context_show' | translate }}</span>
                <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Conditions -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="openEditRunConditions()">
                <span *ngIf="workflow.permission === permissionEnum.READ_WRITE_EXECUTE">{{ 'workflow_node_condition_edit' | translate }}</span><span
                    *ngIf="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">{{ 'workflow_node_condition_show' | translate }}</span>
                <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Pipeline -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" [routerLink]="['/project', project.key, 'pipeline', workflow.pipelines[node.context.pipeline_id].name]"
               [queryParams]="{workflow: workflow.name }">
                <span *ngIf="workflow.permission === permissionEnum.READ_WRITE_EXECUTE">{{ 'pipeline_label_edit' | translate }}</span><span
                    *ngIf="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">{{ 'pipeline_label_show' | translate }}</span>
                <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- HOOK -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder"
               (click)="openAddHookModal()"
               *ngIf="workflow && workflow.root.id === node.id && !(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_hook_add' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Out Going Hook -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="openAddOutgoingHookModal()"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_outgoing_hook' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Parent node -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="openAddParentModal()"
               *ngIf="workflow && workflow.root.id === node.id && !(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_parent' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Add a pipeline -->
        <ng-container>
            <a class="item noborder" (click)="openTriggerModal()"
               *ngIf="!(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_trigger_add' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Add a fork -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="createFork()"
               *ngIf="!(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_fork_add' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <!-- Add a Join -->
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="createJoin()"
               *ngIf="!(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_join_add' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <ng-container *ngIf="node.type === 'pipeline'">
            <a class="item noborder" (click)="linkJoin()"
               *ngIf="!(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_join_link' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
        <ng-container *ngIf="node.type === 'outgoinghook'">
            <a class="item noborder" (click)="openHookEditModal()">
                <span *ngIf="workflow.permission === permissionEnum.READ_WRITE_EXECUTE">{{'btn_edit' | translate}}</span><span *ngIf="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">Configuration</span> <i class="angle right icon"></i>
            </a>
        </ng-container>
        <ng-container>
            <a class="item noborder" (click)="openDeleteNodeModal()"
               *ngIf="!(workflow.from_repository && workflow.from_repository.length > 0)"
               [class.disabled]="workflow.permission < permissionEnum.READ_WRITE_EXECUTE">
                {{ 'workflow_node_delete_btn' | translate }} <i class="angle right icon"></i>
            </a>
        </ng-container>
    </div>
</div>
<div class="ui text active loader" *ngIf="!node">{{ 'workflow_loading' | translate }}</div>


<!-- MODALS -->
<ng-container *ngIf="project && node && workflow">

    <!-- Context -->
    <ng-container *ngIf="node.type === 'pipeline'">
        <app-workflow-node-context [loading]="loading" [node]="node" [project]="project" [workflow]="workflow"
                                   (contextEvent)="updateWorkflow($event, workflowContext.modal)" #workflowContext></app-workflow-node-context>
    </ng-container>

    <!-- Conditions -->
    <ng-container *ngIf="node.type === 'pipeline'">
        <app-workflow-node-conditions [loading]="loading" [project]="project" [workflow]="workflow" [node]="node"
                                      (conditionsEvent)="updateWorkflow($event, workflowConditions.modal)"
                                      #workflowConditions></app-workflow-node-conditions>
    </ng-container>

    <!-- Delete Node -->
    <app-workflow-node-delete [loading]="loading" [node]="node" [workflow]="workflow" (deleteEvent)="updateWorkflow($event, workflowDeleteNode.modal)" #workflowDeleteNode></app-workflow-node-delete>

    <!-- Add trigger -->
    <app-workflow-trigger [loading]="loading" [project]="project" [workflow]="workflow" [source]="node"
                          (triggerEvent)="updateWorkflow($event, workflowTrigger.modal)"
                          #workflowTrigger></app-workflow-trigger>
</ng-container>






<!--
<ng-container *ngIf="project && node && node.id === workflow.root.id">
    <ng-template let-context let-modal="modal" #nodeParentModal>
        <div class="header">{{ 'workflow_node_parent' | translate }}</div>
        <div class="content ui form">
            <app-workflow-node-form [project]="project" [(node)]="newParentNode"></app-workflow-node-form>
        </div>
        <div class="actions">
            <button class="ui grey button" [disabled]="loading" (click)="modal.approve(true)">{{ 'common_close' |
                translate }}
            </button>
            <button class="ui green button" [disabled]="loading" (click)="addNewParentNode($event)">{{ 'btn_save' |
                translate }}
            </button>
        </div>
    </ng-template>
</ng-container>



<ng-container *ngIf="project && node">
    <app-workflow-node-hook-form [loading]="loading" [project]="project" [workflow]="workflow" [node]="node"
                                 [isOutgoing]="false" (hookEvent)="addHook($event)"
                                 #worklflowAddHook></app-workflow-node-hook-form>
</ng-container>
<ng-container *ngIf="project && node">
    <app-workflow-node-hook-form [loading]="loading" [project]="project" [workflow]="workflow" [node]="node"
                                 [isOutgoing]="true" (hookEvent)="addOutgoingHook($event)"
                                 #worklflowAddOutgoingHook></app-workflow-node-hook-form>
</ng-container>
<ng-template let-context let-modal="modal" #nodeNameWarningModal>
    <div class="header">{{ 'workflow_node_name_warning_modal_title' | translate }}</div>
    <div class="content">
        <ng-container *ngIf="nameWarning && nameWarning.hooks && nameWarning.hooks.length > 0">
            <h3>{{'workflow_node_name_warning_modal_hooks' | translate }}</h3>
            <ul>
                <li *ngFor="let h of nameWarning.hooks">
                    {{h.model.name}}
                </li>
            </ul>
        </ng-container>
        <ng-container *ngIf="nameWarning && (nameWarning.triggers.length > 0 || nameWarning.joinTriggers.length > 0)">
            <h3>{{'workflow_node_name_warning_modal_triggers' | translate }}</h3>
            <ul>
                <li *ngFor="let t of nameWarning.triggers">
                    {{t.workflow_dest_node.name}}
                </li>
                <li *ngFor="let t of nameWarning.joinTriggers">
                    {{t.workflow_dest_node.name}}
                </li>
            </ul>
        </ng-container>
    </div>
    <div class="actions">
        <button class="ui grey button" [disabled]="loading" (click)="modal.approve(true)">{{ 'common_close' | translate
            }}
        </button>
    </div>
</ng-template>
-->